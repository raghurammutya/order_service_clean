[tool.ruff.lint]
# Enable specific rules to catch dangerous exception handling
select = [
    "E",   # pycodestyle errors
    "W",   # pycodestyle warnings  
    "F",   # pyflakes
    "B",   # flake8-bugbear (catches dangerous patterns)
    "SIM", # flake8-simplify
]

# Specific rules for exception handling safety
extend-select = [
    "BLE001", # Do not catch blind exception: Exception
]

[tool.ruff.lint.per-file-ignores]
# CRITICAL MODULES: BLE001 violations flagged but intentional fallbacks documented
# These modules use structured exception handling with intentional final fallbacks
# See EXCEPTION_HANDLING_ARCHITECTURE.md for security documentation
"app/services/pnl_calculator.py" = []    # Financial calculation security
"app/services/kite_client.py" = []       # Order processing security  
"app/services/handoff_state_machine.py" = []  # State transition security
"app/workers/sync_workers.py" = []       # Background worker safety
"app/api/v1/endpoints/pnl.py" = []       # P&L API endpoint security
"app/api/v1/endpoints/capital_ledger.py" = []  # Capital API endpoint security

# STANDARD MODULES: No broad exception handling allowed
"app/api/v1/endpoints/*.py" = []         # API endpoints must use specific handling
"app/services/*.py" = []                # Services must use specific handling  
"app/workers/*.py" = []                 # Workers must use specific handling

# ALLOWED: Test and utility contexts
"*/test_*.py" = ["BLE001"]             # Tests can catch all exceptions
"scripts/*" = ["BLE001"]               # Scripts can have broad error handling
"app/config/*" = ["BLE001"]            # Configuration helpers (lower risk)

[tool.ruff.lint.flake8-bugbear]
# Additional bugbear configuration
extend-immutable-calls = ["fastapi.Depends", "pydantic.Field"]

# Exception handling documentation
# BLE001 violations in critical modules are INTENTIONAL FALLBACKS
# These catch unexpected system errors after specific handling
# Pattern: log CRITICAL + re-raise structured exception
# See EXCEPTION_HANDLING_ARCHITECTURE.md for details